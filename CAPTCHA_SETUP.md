# Пошаговая инструкция: как включить капчу (Turnstile)

Капча уже встроена в форму на сайте. Чтобы она заработала, нужно один раз получить два ключа и прописать их в двух местах. Ниже — по шагам.

---

## Часть 1. Получить ключи в Cloudflare Turnstile

### Шаг 1.1. Зайти в Cloudflare

1. Откройте в браузере: **https://dash.cloudflare.com**
2. Если нет аккаунта — нажмите **Sign Up** и зарегистрируйтесь (бесплатно).
3. Войдите в аккаунт.

### Шаг 1.2. Открыть раздел Turnstile

1. В левом меню найдите раздел **Turnstile** (может быть под «Products» или в списке сервисов).
2. Нажмите **Turnstile**.
3. Если спрашивают «Add a site» или «Get started» — нажмите это.

### Шаг 1.3. Создать виджет (виджет = одна капча для одной формы)

1. Нажмите кнопку **Add widget** / **Create widget**.
2. Заполните:
   - **Widget name** — любое, например: `Форма заявки сайта`.
   - **Domain** — домен вашего сайта, например: `timetoitai.ru` (без https:// и без пути). Если сайт пока на другом домене — укажите его. Можно потом добавить ещё домены в настройках виджета.
   - **Widget Mode** оставьте **Managed** (рекомендуется) или **Non-interactive** (вообще без действий для пользователя).
3. Нажмите **Create** / **Создать**.

### Шаг 1.4. Скопировать ключи

После создания виджета откроется страница с двумя ключами:

- **Site Key** (или «Client-side key») — длинная строка, например: `0x4AAAAAAA...`
- **Secret Key** (или «Server-side key») — другая длинная строка.

Важно:
- **Site Key** понадобится в шаге 2 (сайт / GitHub).
- **Secret Key** понадобится в шаге 3 (Formspree).

Скопируйте оба ключа и сохраните в блокнот или в браузере (можно временно оставить вкладку открытой).

---

## Часть 2. Прописать Site Key на сайте (в GitHub)

Сайт собирается в GitHub Actions и выкладывается на Reg.ru. Ключ нужно передать в момент сборки.

### Шаг 2.1. Открыть настройки репозитория в GitHub

1. Откройте ваш репозиторий: **https://github.com/MogilaVladik/Syte-for-promt**
2. Нажмите вкладку **Settings** (Настройки).
3. В левом меню выберите **Secrets and variables** → **Actions**.

### Шаг 2.2. Добавить переменную для Site Key

1. В левом меню выберите **Variables** (именно «Переменные», не Secrets).
2. Нажмите **New repository variable**.
3. В поле **Name** введите **точно** (можно скопировать):  
   `NEXT_PUBLIC_TURNSTILE_SITE_KEY`
4. В поле **Value** вставьте ваш **Site Key** из Cloudflare (из шага 1.4).
5. Нажмите **Add variable** / **Save**.

Готово. При следующей сборке (после пуша в `main`) капча на сайте подхватит этот ключ и начнёт показываться.

---

## Часть 3. Прописать Secret Key в Formspree

Formspree будет проверять капчу и перестанет помечать такие заявки как спам.

### Шаг 3.1. Открыть форму в Formspree

1. Зайдите на **https://formspree.io** и войдите в аккаунт.
2. Откройте ваш проект и форму **promting** (та, куда уходят заявки).

### Шаг 3.2. Включить Turnstile

1. Откройте вкладку **Settings** (Настройки).
2. Найдите раздел про защиту от спама: **Spam prevention**, **Security** или **Captcha**.
3. Найдите пункт **Cloudflare Turnstile** и включите его (переключатель или кнопка **Enable**).
4. В поле **Turnstile Secret Key** вставьте **Secret Key** из Cloudflare (из шага 1.4).
5. Сохраните настройки (**Save**).

После этого Formspree будет проверять капчу и принимать заявки с вашего сайта как обычные (не спам).

---

## Часть 4. Проверить, что всё работает

1. Дождитесь следующей сборки сайта в GitHub (после любого пуша в ветку `main`) или запустите её вручную (Actions → Deploy to Reg.ru → Run workflow).
2. Откройте сайт (на том домене, который вы указали в Turnstile).
3. Перейдите к форме «Оставить заявку».
4. Должна появиться капча (маленький виджет Cloudflare под полями Имя и Telegram). Иногда он проверяет автоматически, иногда нужно нажать галочку.
5. Заполните форму и отправьте заявку.
6. Проверьте в Formspree во вкладке **Submissions** → **Inbox**: заявка должна прийти в Inbox, а не в Spam, и вам должно прийти письмо на почту.

---

## Если что-то не работает

- **Капча не показывается на сайте**  
  - Проверьте, что переменная в GitHub называется **точно** `NEXT_PUBLIC_TURNSTILE_SITE_KEY` и что после её добавления вы сделали новый пуш и прошла сборка.
  - Убедитесь, что в Cloudflare в настройках виджета указан ваш домен (например, `timetoitai.ru`).

- **Заявки всё равно попадают в Spam в Formspree**  
  - Убедитесь, что в Formspree в настройках формы включён **Cloudflare Turnstile** и вставлен именно **Secret Key** (не Site Key).
  - Сохраните настройки и отправьте тестовую заявку ещё раз.

- **Домен другой**  
  - В Cloudflare Turnstile в настройках виджета можно добавить несколько доменов (например, и timetoitai.ru, и другой домен, где крутится сайт).

---

Кратко: **Site Key** → в GitHub в переменную `NEXT_PUBLIC_TURNSTILE_SITE_KEY`; **Secret Key** → в Formspree в настройках формы в поле Turnstile Secret Key. После этого капча будет работать, а заявки — приходить в Inbox и на почту.
